<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>Beer Mini‚ÄëApp | Router + BackButton + No‚ÄëSwipe</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <meta name="format-detection" content="telephone=no" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

<script src="js/app_block_01.js"></script>

<script src="js/app_block_02.js"></script>
<script src="js/app_block_03.js"></script>




  



 




  









<!-- –ü–†–û–§–ò–õ–¨ –°—Ç–∏–ª–∏ –ø—Ä–æ—Ñ–∏–ª—è (–ª–∞–∫–æ–Ω–∏—á–Ω—ã–µ, –¥—Ä—É–∂–∞—Ç —Å —Ç–≤–æ–∏–º–∏ .card/.btn) -->









  <link rel="stylesheet" href="css/main.css">
</head>
<body>

<!-- ========== BeerCraft Loader (scoped & clean) ========== -->
<div id="app-preloader" class="bcl-root" aria-hidden="true" style="--size:110px;">
  <style>
    /* ====== SCOPED (–≤—Å—ë –ø–æ–¥ .bcl-root) ====== */
    .bcl-root{
      position:fixed; inset:0; display:flex; align-items:center; justify-content:center;
      background: radial-gradient(120% 80% at 50% 0%, #121416 0%, #0B0D11 45%, #07080A 100%);
      z-index:99999; transition:opacity .35s, visibility .35s;
    }
    .bcl-root.is-hidden{ opacity:0; visibility:hidden; pointer-events:none; }
    .bcl-wrap{ display:flex; flex-direction:column; align-items:center; gap:12px; }
    .bcl-badge{ width:var(--size,110px); height:auto; }
    .bcl-caption{ color:#EDF2F7; font:600 13px/1.1 Inter, system-ui, Arial; opacity:.9; letter-spacing:.2px; }

    /* –ö–æ–ª—å—Ü–µ–≤–∞—è ¬´–∫–∞–ª–∏—è¬ª –∏ –±–µ–≥—É–Ω–æ–∫ ‚Äî –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö —Ç–µ–Ω–µ–π */
    .spinner-dash{ stroke-dashoffset:0; animation:dash 1.15s linear infinite; filter:none; }
    @keyframes dash { to { stroke-dashoffset:-800; } }

    /* ¬´–ù–∞–ª–∏–≤¬ª –ø–∏–≤–∞ */
    .beer{ transform-origin:50% 100%; animation:fill 1.8s ease-in-out forwards .1s; }
    @keyframes fill{ from{transform:scaleY(0);} to{transform:scaleY(.78);} }

    /* –í–æ–ª–Ω—ã –≤–Ω—É—Ç—Ä–∏ –ø–∏–≤–∞ */
    .bcl-waveA{ animation:waveA 3.6s linear infinite .2s; }
    .bcl-waveB{ animation:waveB 5.2s linear infinite 0s; opacity:.95; }
    @keyframes waveA{ to{ transform:translateX(-240px);} }
    @keyframes waveB{ to{ transform:translateX(-240px);} }

    /* –ü–µ–Ω–∞: –º—è–≥–∫–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ + –ª—ë–≥–∫–æ–µ ¬´–¥—ã—Ö–∞–Ω–∏–µ¬ª */
    .foam{ opacity:0; transform:translateY(-20px); animation:
      foamAppear .35s ease-out forwards .15s,
      foamDrop   1.8s cubic-bezier(.22,.61,.21,1) forwards .10s;
    }
    @keyframes foamAppear{ to{opacity:1;} }
    @keyframes foamDrop  { to{transform:translateY(0);} }
    .foam-crest,.foam-crest2{ animation:crest 2.6s ease-in-out infinite alternate; }
    @keyframes crest{ from{transform:translateY(0);} to{transform:translateY(1.2px);} }

    /* –ü—É–∑—ã—Ä—å–∫–∏ –Ω–∞ –∫—Ä–æ–º–∫–µ */
    .foam-pops circle{ opacity:0; transform:translateY(0) scale(.9); animation:pop 1.6s ease-out infinite; }
    .foam-pops circle:nth-child(1){ animation-delay:.2s; }
    .foam-pops circle:nth-child(2){ animation-delay:.7s; }
    .foam-pops circle:nth-child(3){ animation-delay:1.1s; }
    .foam-pops circle:nth-child(4){ animation-delay:1.35s; }
    @keyframes pop{
      0%{opacity:0; transform:translateY(0) scale(.9);}
      25%{opacity:.95; transform:translateY(-2px) scale(1.05);}
      60%{opacity:.75; transform:translateY(-4px) scale(1);}
      100%{opacity:0; transform:translateY(-8px) scale(.95);}
    }

    /* –ü—É–∑—ã—Ä—å–∫–∏ –≤ –ø–∏–≤–µ */
    .bubbles circle{ fill:#FFE9A6; opacity:0; transform:translateY(0); animation:rise 2.4s ease-in-out infinite; }
    .bubbles circle:nth-child(2){ animation-delay:.3s; }
    .bubbles circle:nth-child(3){ animation-delay:.6s; }
    .bubbles circle:nth-child(4){ animation-delay:.9s; }
    .bubbles circle:nth-child(5){ animation-delay:1.2s; }
    @keyframes rise{ 0%{opacity:0; transform:translateY(0) scale(.9);} 20%{opacity:.85;} 100%{opacity:0; transform:translateY(-90px) scale(1.05);} }

    /* –±–µ–∑ –ª–∏—à–Ω–∏—Ö –≤–Ω–µ—à–Ω–∏—Ö –æ–±–≤–æ–¥–æ–∫; –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –∫–∞–ª–∏—é –∏ –±–µ–≥—É–Ω–æ–∫ */
    .bcl-highlight{ display:none; }

    @media (prefers-reduced-motion: reduce){
      .beer,.bcl-waveA,.bcl-waveB,.foam,.foam-crest,.foam-crest2,.foam-pops circle,.bubbles circle{ animation:none !important; }
    }
  </style>

  <div class="bcl-wrap">
    <svg class="bcl-badge" viewBox="0 0 240 240" role="img" aria-label="–ó–∞–≥—Ä—É–∑–∫–∞">
      <defs>
        <!-- –í–ê–ñ–ù–û: —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ ID, —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ—Å–µ–∫–∞–ª–∏—Å—å —Å –¥—Ä—É–≥–∏–º–∏ SVG -->
        <clipPath id="bcl-clip"><circle cx="120" cy="120" r="92"/></clipPath>

        <linearGradient id="bcl-beer" x1="0" y1="0" x2="0" y2="1">
          <stop offset="0%"  stop-color="#FAD97A"/>
          <stop offset="65%" stop-color="#E3A71A"/>
          <stop offset="100%" stop-color="#C58500"/>
        </linearGradient>

        <filter id="bcl-soft" x="-30%" y="-30%" width="160%" height="160%">
          <feGaussianBlur stdDeviation="1.2"/>
        </filter>

        <filter id="bcl-foamGrain" x="-15%" y="-40%" width="130%" height="180%">
          <feTurbulence type="fractalNoise" baseFrequency="0.75" numOctaves="1" seed="7" result="n"/>
          <feColorMatrix type="matrix" values="
            1 0 0 0 0
            0 1 0 0 0
            0 0 1 0 0
            0 0 0 1.15 -0.15"/>
          <feDisplacementMap in="SourceGraphic" in2="n" scale="1.6" xChannelSelector="R" yChannelSelector="G"/>
        </filter>
      </defs>

      <!-- –¢–æ–Ω–∫–∞—è ¬´–∫–∞–ª–∏—è¬ª (—Ç—Ä–µ–∫) -->
      <circle class="bcl-track" cx="120" cy="120" r="108" fill="none"
              stroke="rgba(255,255,255,.08)" stroke-width="6"/>

      <!-- –ë–µ–≥—É–Ω–æ–∫ –ø–æ –∫–∞–ª–∏–∏ (CSS + SMIL; JS-fallback –æ—Å—Ç–∞–Ω–µ—Ç—Å—è —Ä–∞–±–æ—á–∏–º) -->
      <circle class="spinner-dash" cx="120" cy="120" r="108" fill="none"
              stroke="#FFD36B" stroke-width="6" stroke-linecap="round"
              stroke-dasharray="120 680" stroke-dashoffset="0">
        <animate attributeName="stroke-dashoffset" values="0;-800" dur="1.15s" repeatCount="indefinite"/>
      </circle>

      <!-- –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å—Ü–µ–Ω–∞ -->
      <g clip-path="url(#bcl-clip)">
        <!-- –Ø–Ω—Ç–∞—Ä—å + –≤–æ–ª–Ω—ã -->
        <g class="beer">
          <g class="bcl-waveA">
            <rect x="-240" y="60" width="720" height="160" fill="url(#bcl-beer)"/>
            <path d="M-240,110 q28,-12 56,0 t56,0 t56,0 t56,0 t56,0 l0,110 l-280,0 Z" fill="rgba(255,255,255,.08)"/>
          </g>
          <g class="bcl-waveB">
            <rect x="-240" y="70" width="720" height="160" fill="url(#bcl-beer)"/>
            <path d="M-240,120 q26,-11 52,0 t52,0 t52,0 t52,0 t52,0 l0,100 l-260,0 Z" fill="rgba(255,255,255,.05)"/>
          </g>
        </g>

        <!-- –ü–µ–Ω–∞ (–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –∏ —Å—Ç—ã–∫—É–µ—Ç—Å—è –≤–∏–∑—É–∞–ª—å–Ω–æ —Å –≤–µ—Ä—Ö–æ–º —è–Ω—Ç–∞—Ä—è) -->
        <g class="foam" filter="url(#bcl-soft)">
          <path class="foam-crest"  d="M44,62 C78,54 162,54 196,62 L196,74 L44,74 Z" fill="#fff" opacity=".97"/>
          <path class="foam-crest2" d="M44,61 C78,53 162,53 196,61 L196,73 L44,73 Z" fill="#fff" opacity=".55"/>
          <rect x="44" y="56" width="152" height="20" fill="#fff" opacity=".22" filter="url(#bcl-foamGrain)"/>
          <g class="foam-pops">
            <circle cx="78"  cy="60" r="2.6" fill="#fff"/>
            <circle cx="108" cy="59" r="3.0" fill="#fff"/>
            <circle cx="138" cy="60" r="2.3" fill="#fff"/>
            <circle cx="164" cy="59" r="2.5" fill="#fff"/>
          </g>
        </g>

        <!-- –ü—É–∑—ã—Ä—å–∫–∏ –≤ –ø–∏–≤–µ -->
        <g class="bubbles">
          <circle cx="82"  cy="170" r="2.2"/>
          <circle cx="104" cy="186" r="1.9"/>
          <circle cx="128" cy="178" r="2.4"/>
          <circle cx="150" cy="192" r="2.0"/>
          <circle cx="112" cy="196" r="1.7"/>
        </g>

        <!-- –ë–ª–∏–∫ –≤—ã–∫–ª—é—á–µ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∫–ª–∞—Å—Å–æ–º .bcl-highlight -->
        <ellipse class="bcl-highlight" cx="95" cy="95" rx="70" ry="95" fill="rgba(255,255,255,.18)"/>
      </g>
    </svg>

    <div class="bcl-caption" id="app-preloader-caption">–ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è‚Ä¶</div>
  </div>
</div>
<!-- ========== /BeerCraft Loader ========== -->













  
  <canvas id="confetti"></canvas>
  <div class="wrap">
    <nav id="btm-nav" class="btm-nav" aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è">
      <button class="tab" data-page="home"><img src="img/ic_home.png" alt=""><span>–ì–ª–∞–≤–Ω–∞—è</span></button>
      <button class="tab" data-page="leaderboard"><img src="img/ic_services.png" alt=""><span>–¢—É—Ä–Ω–∏—Ä</span></button>
      <button class="tab" data-open-flappy><img src="img/ic_consult.png" alt=""><span>–ò–≥—Ä–∞—Ç—å</span></button>
      <!-- <button class="tab" data-page="games"><img src="img/ic_consult.png" alt=""><span>–ò–≥—Ä–∞—Ç—å</span></button> -->
      <button class="tab" data-page="bonuses"><img src="img/ic_bonus.png" alt=""><span>–ë–æ–Ω—É—Å—ã</span></button>
      <button class="tab" data-page="profile"><img src="img/ic_about.png" alt=""><span>–ü—Ä–æ—Ñ–∏–ª—å</span></button>
    </nav>

    <main>


<!-- –¢–û–°–¢ –û–∫–æ—à–∫–æ –ø–æ–ø –∞–ø–ø –≤—Å–ø–ª—ã–≤–∞—é—â–µ–µ -->
<div id="toasts" class="toasts" aria-live="polite"></div>



<!-- –°–ª–∞–π–¥—ã Slider -->

<div id="intro" class="intro" aria-hidden="true" role="dialog" aria-modal="true">
  <div class="intro__wrap">
    <div class="intro__progress" id="intro-progress"></div>

    <div class="intro__stage">
      <div class="intro__slides" id="intro-slides">
        <!-- 1 -->
        <section class="intro__slide active">
          <h2 class="intro__h1">–ü—Ä–∏–≤–µ—Ç –¥—Ä—É–≥!</h2>
          <p class="intro__p">–ó–¥–µ—Å—å –∫—É–ª—å—Ç—É—Ä–∞ –∫—Ä–∞—Ñ—Ç–∞! –≠—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–æ –∏–≥—Ä—ã, –±–æ–Ω—É—Å—ã –∏ –∑–Ω–∞–Ω–∏–µ –ø–∏–≤–Ω—ã—Ö —Å—Ç–∏–ª–µ–π.
–ü—Ä–æ–¥–æ–ª–∂–∞—è, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—à—å –≤–æ–∑—Ä–∞—Å—Ç 18+ –∏ —Å–æ–≥–ª–∞—Å–∏–µ —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏.</p>
        </section>
        <!-- 2 -->
        <section class="intro__slide">
          <h2 class="intro__h1">–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?</h2>
          <p class="intro__p">–ò–≥—Ä–∞–π –≤ ¬´–®–º–µ–ª—è¬ª, –ø—Ä–æ—Ö–æ–¥–∏ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã, —Å–æ–±–∏—Ä–∞–π –ü–∞—Å–ø–æ—Ä—Ç —Å—Ç–∏–ª–µ–π.
–ó–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å ‚Äî –º–æ–Ω–µ—Ç—ã. –ú–æ–Ω–µ—Ç—ã ‚Äî –∫–æ–ª–µ—Å–æ –±–æ–Ω—É—Å–æ–≤, –º–µ—Ä—á, —Å–Ω–µ–∫–∏, –∫—É–ø–æ–Ω—ã.</p>
        </section>

        <!-- 3 -->
        <section class="intro__slide">
          <h2 class="intro__h1">–ü—Ä–æ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ</h2>
          <p class="intro__p">–ú—ã –ª–æ–∫–∞–ª—å–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞: —Å–≤–µ–∂–µ—Å—Ç—å, –º–∞–ª—ã–µ –ø–∏–≤–æ–≤–∞—Ä–Ω–∏, —Å–µ–∑–æ–Ω–Ω—ã–µ –ø–∞—Ä—Ç–∏–∏.
–ï—Å—Ç—å –±–µ–∑–∞–ª–∫–æ–≥–æ–ª—å–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏, –¥—Ä—É–∂–∏–º —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ –∑–∞–∫—É—Å–∫–∞–º–∏ –∏ –º–µ—Ä—á–µ–º.</p>
        </section>

                <!-- 4 -->
        <section class="intro__slide">
          <h2 class="intro__h1">–û—Ç–ª–∏—á–Ω–æ! –ü–æ–≥–Ω–∞–ª–∏</h2>
          <p class="intro__p">–ü–µ—Ä–≤—ã–π —Å–ø–∏–Ω ‚Äî –≤ –ø–æ–¥–∞—Ä–æ–∫. –í –ø—Ä–æ—Ñ–∏–ª–µ –≤–∏–¥–Ω—ã –±–∞–ª–∞–Ω—Å, –ø—Ä–∏–∑—ã –∏ —Ä–µ—Ñ–µ—Ä–∞–ª—ã.
–ò–≥—Ä–∞–π —á–µ—Å—Ç–Ω–æ, –±–æ–Ω—É—Å—ã –∑–∞–±–∏—Ä–∞–π –≤ –º–∞–≥–∞–∑–∏–Ω–µ.</p>
        </section>
      </div>
    </div>

    <!-- —Å—é–¥–∞ JS –±—É–¥–µ—Ç —Ä–µ–Ω–¥–µ—Ä–∏—Ç—å –Ω—É–∂–Ω—ã–π –Ω–∞–±–æ—Ä –∫–Ω–æ–ø–æ–∫ -->
    <div id="intro-actions" class="intro__actions"></div>
  </div>
</div>


<!-- FLAPPY LITE+ –®–ú–ï–õ–¨ (overlay) -->

<div id="flappy" class="flappy" aria-hidden="true" role="dialog" aria-modal="true">
  <div class="flappy__wrap">
    <!-- HUD -->
    <div class="fl-hud">
      <div class="fl-hud__row">
        <div id="fl-score" class="fl-score">0</div>
        <div class="fl-bar"><i id="fl-bar"></i></div>
      </div>
      <div class="fl-stats">
        <div class="fl-stat">
          <i id="fl-coin-ico" class="fl-ico"></i>
          <span id="fl-coin-count">0</span>
        </div>
        <div class="fl-stat fl-shield-wrap">
          <i id="fl-shield-ico" class="fl-ico"></i>
          <div class="fl-shield-bar"><i id="fl-shield-bar"></i></div>
        </div>
      </div>
    </div>

    <!-- STAGE -->
    <div id="fl-stage" class="fl-stage">
      <div id="fl-hint" class="fl-hint">–¢–∞–ø–Ω–∏ —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å</div>
      <div id="fl-bird" class="fl-bird" aria-label="bird"></div>

      <!-- RESULT -->
      <div id="fl-result" class="fl-result" aria-hidden="true">
        <div class="fl-card">
          <div class="fl-cell"><div class="fl-val" id="fl-best">0</div><div class="fl-sub">üéØ –¢–≤–æ–π —Ä–µ–∫–æ—Ä–¥</div></div>
          <div class="fl-cell"><div class="fl-val" id="fl-world">200</div><div class="fl-sub">üèÜ –ú–∏—Ä–æ–≤–æ–π —Ä–µ–∫–æ—Ä–¥</div></div>
          <div class="fl-chev">‚Ä∫</div>
        </div>
      </div>
    </div>

    <!-- CTA -->
    <div id="fl-cta" class="fl-cta">
      <button class="btn" data-open-flappy>–ü–æ–ø—Ä–æ–±—ã–≤–∞—Ç—å –µ—â–µ —Ä–∞–∑</button>
    </div>
  </div>
</div>



<!-- Bottom Sheet -->
 
      <div id="sheet" class="sheet sheet-bottom" aria-hidden="true" role="dialog" aria-modal="true">
        <div class="sheet__overlay" data-close-sheet></div>
        <section class="sheet__panel" tabindex="-1">
          <div class="sheet__handle"></div>
          <header class="sheet__header">
<!-- ===== <h3 class="sheet__title">–ó–∞–≥–æ–ª–æ–≤–æ–∫</h3> ===== -->
            <button class="sheet__close" aria-label="–ó–∞–∫—Ä—ã—Ç—å" data-close-sheet>‚ùå</button>
          </header>
          <div class="sheet__body" id="sheet-body"></div>
        </section>
      </div>

      <!-- ===== Templates for sheets ===== -->


      <template id="tpl-lastpriz">
  <div class="card">
    <div class="h1">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø—Ä–∏–∑—ã</div>
    <div id="pf-prizes-sheet">
      <div class="pf-muted">–ü–æ–∫–∞ –ø—É—Å—Ç–æ.</div>
    </div>
  </div>
</template>


<template id="tpl-passport">
  <div class="card passport">
    <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –∫–∞—Ä—Ç–∏–Ω–∫–∞ -->
    <figure class="passport__media">
      <img src="img/beer_hero.jpg" alt="–ü–∏–≤–Ω–æ–π –ø–∞—Å–ø–æ—Ä—Ç">
    </figure>

    <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="passport__body">
      <div>
        <div class="h1" style="margin:0 0 6px">–ü–∞—Å–ø–æ—Ä—Ç —Å—Ç–∏–ª–µ–π</div>
        <p class="muted-sm" style="margin:0">
          –°–æ–±–µ—Ä–∏ 6 —à—Ç–∞–º–ø–æ–≤: <b>Lager</b>, <b>IPA</b>, <b>Stout</b>, <b>Weizen</b>, <b>Sour</b>, <b>Cider</b> ‚Äî –ø—Ä–∏–∑.
        </p>
      </div>

      <!-- –°–µ—Ç–∫–∞ –º–∏–Ω–∏-–∫–∞—Ä—Ç–æ—á–µ–∫ -->
      <div id="passport-grid">
        <div class="pslot" data-code="Lager">
          <div class="pslot__title">Lager</div>
          <div class="pslot__badge">–ü–æ–ª—É—á–∏—Ç—å</div>
        </div>
        <div class="pslot" data-code="IPA">
          <div class="pslot__title">IPA</div>
          <div class="pslot__badge">–ü–æ–ª—É—á–∏—Ç—å</div>
        </div>
        <div class="pslot" data-code="Stout">
          <div class="pslot__title">Stout</div>
          <div class="pslot__badge">–ü–æ–ª—É—á–∏—Ç—å</div>
        </div>
        <div class="pslot" data-code="Weizen">
          <div class="pslot__title">Weizen</div>
          <div class="pslot__badge">–ü–æ–ª—É—á–∏—Ç—å</div>
        </div>
        <div class="pslot" data-code="Sour">
          <div class="pslot__title">Sour</div>
          <div class="pslot__badge">–ü–æ–ª—É—á–∏—Ç—å</div>
        </div>
        <div class="pslot" data-code="Cider">
          <div class="pslot__title">Cider</div>
          <div class="pslot__badge">–ü–æ–ª—É—á–∏—Ç—å</div>
        </div>
      </div>
</template>





<!-- ===== –∫–≤–∏–∑ —Ä–µ–Ω–¥–µ—Ä –∏–∑ js ===== -->
<template id="tpl-trivia">
  <div class="card trivia-card">
    <div id="trivia-start" class="trivia-start">
      <div class="trivia-start-inner">
        <div class="trivia-start-icon">
          <img src="img/casino-chips.png" alt="" loading="lazy">
        </div>
        <div class="trivia-start-copy">
          <div class="trivia-title">–û—Ç–≤–µ—Ç—å –Ω–∞ 4 –ø—Ä–æ—Å—Ç—ã—Ö –≤–æ–ø—Ä–æ—Å–∞ –∏ –ø–æ–ª—É—á–∏ 100 –º–æ–Ω–µ—Ç</div>
          <p id="trivia-start-hint" class="trivia-start__hint" style="display:none"></p>
        </div>
      </div>

      <button type="button"
              class="btn btn-primary trivia-start-btn"
              data-action="trivia-start">
        –ù–∞—á–∞—Ç—å
      </button>
    </div>

    <div id="trivia-body"></div>
  </div>
</template>








      <template id="tpl-ref">
       <div class="card">
          <div class="h1">–ü—Ä–∏–≥–ª–∞—Å–∏ –¥—Ä—É–∑–µ–π</div>
          <p class="muted-sm">–ó–∞ –¥—Ä—É–≥–∞ ‚Äî +100 –º–æ–Ω–µ—Ç. –ó–∞ 3 –¥—Ä—É–∑–µ–π ‚Äî –º–∏–Ω–∏‚Äë–¥–µ–≥—É—Å—Ç–∞—Ü–∏—è.</p>
          <div class="g">
            <input id="ref-link" class="btn" readonly value="" />
            <div class="g g2">
              <button class="btn btn-primary" data-action="copy-ref">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <button class="btn" data-action="share-ref">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
            </div>
          </div>
        </div>
      </template>


<!-- ===== PAGES –°—Ç—Ä–∞–Ω–∏—Ü—ã ===== -->

      <section class="page" id="home">
        <div class="hero">
          <img class="hero__media" src="img/beer_hero.jpg" alt="Beer Hero">
        </div>

        <div class="promo">
          <div class="promo__icon"><img src="img/beer_cup.png" alt=""></div>
          <div>
            <div class="promo__title">Craft Beer</div>
            <div class="promo__sub">–ö—Ç–æ –º—ã, –≥–¥–µ –º—ã</div>
          </div>
          <button class="promo__btn" data-open-intro
          aria-controls="intro"
          aria-label="–û—Ç–∫—Ä—ã—Ç—å –æ–Ω–±–æ—Ä–¥–∏–Ω–≥">–û –Ω–∞—Å</button>
        </div>

        <div class="card list-card tight">
          <div class="list-head">–° —á–µ–≥–æ –Ω–∞—á–∞—Ç—å</div>
          <div class="list">
            <div class="list__item">
              <div class="list__icon"><img src="img/pasport.png" alt=""></div>
              <div class="list__text">
                <div class="list__title">–ü–∞—Å–ø–æ—Ä—Ç —Å—Ç–∏–ª–µ–π</div>
                <div class="list__sub">–°–æ–±–µ—Ä–∏ 6 —à—Ç–∞–º–ø–æ–≤ ‚Äî –ø–æ–¥–∞—Ä–æ–∫</div>
              </div>
              <button class="list__chev-btn" data-open-sheet data-title="–ü–∏–≤–Ω–æ–π –ü–∞—Å–ø–æ—Ä—Ç" data-tpl="#tpl-passport">‚Ä∫</button>
            </div>
            <div class="list__item">
              <div class="list__icon"><img src="img/casino-chips.png" alt=""></div>
              <div class="list__text">
                <div class="list__title">–í–∏–∫—Ç–æ—Ä–∏–Ω–∞</div>
                <div class="list__sub">–ü—Ä–æ–≤–µ—Ä—å —Å–≤–æ–∏ –ø–∏–≤–Ω—ã–µ –∑–Ω–∞–Ω–∏—è</div>
              </div>
              <button class="list__chev-btn" data-open-sheet data-title="–í–∏–∫—Ç–æ—Ä–∏–Ω–∞" data-tpl="#tpl-trivia">‚Ä∫</button>
            </div>
            <div class="list__item">
              <div class="list__icon"><img src="img/fren.png" alt=""></div>
              <div class="list__text">
                <div class="list__title">–ü—Ä–∏–≥–ª–∞—Å–∏ –¥—Ä—É–∑–µ–π</div>
                <div class="list__sub">–î–∞—Ä–∏–º +100 –º–æ–Ω–µ—Ç –∑–∞ –¥—Ä—É–≥–∞</div>
              </div>
              <button class="list__chev-btn" data-open-sheet data-title="–†–µ—Ñ–µ—Ä–∞–ª—ã" data-tpl="#tpl-ref">‚Ä∫</button>
            </div>
          </div>
        </div>

        <!-- Games –∫–∞—Ä—Ç–æ—á–∫–∏ –ò–ì–†–´ -->
<div class="card list-card games tight">
  <div class="list-head">–ò–≥—Ä—ã</div>
  <div class="list">
    <!-- –®–º–µ–ª—å -->
    <div class="list__item">
      <div class="list__icon"><img src="img/bumblebee.png" alt=""></div>
      <div class="list__text">
        <div class="list__title">Bumblebee</div>
        <div class="list__sub">–î–æ–ª–µ—Ç–∏ –¥–æ –Ω–∞—Å –∏ –ø–æ–ª—É—á–∏ –ø—Ä–∏–∑</div>
      </div>
<!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–ø—É—Å–∫–∞ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π -->
<button class="list__btn list__btn--primary" data-open-flappy>–ò–≥—Ä–∞—Ç—å</button>
    </div>

    <!-- –ì–æ–Ω–∫–∏ -->
    <div class="list__item">
      <div class="list__icon"><img src="img/racing.png" alt=""></div>
      <div class="list__text">
        <div class="list__title">Night Racing</div>
        <div class="list__sub">–ö–∞—Ç–∞–π—Å—è –∏ –ø—Ä–æ–∫–∞—á–∏–≤–∞–π —Ç–∞—á–∫—É</div>
      </div>
<!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–ø—É—Å–∫–∞ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π -->
<button class="list__btn list__btn--primary" data-open-runner>C–∫–æ—Ä–æ</button>
    </div>

    <!-- –ë–æ–Ω—É—Å—ã -->
    <div class="list__item">
      <div class="list__icon"><img src="img/beercard.png" alt=""></div>
      <div class="list__text">
        <div class="list__title">Memory cards</div>
        <div class="list__sub">–ù–∞–π–¥–∏ –≤—Å–µ —Å–ø—Ä—è—Ç–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –±—ã—Å—Ç—Ä–µ–µ</div>
      </div>
<!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–ø—É—Å–∫–∞ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π -->
<button class="list__btn list__btn--primary" data-open-runner>–°–∫–æ—Ä–æ</button>

      </div>
</div>
      </section>


      

<!-- –¢—É—Ä–Ω–∏—Ä—ã —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -->
<section id="leaderboard" class="page" style="display:none">


<!-- Leaderboard -->
<div class="card lb-card inner" id="leaderboard">
  <div class="lb-head">
    <div>
      <div class="lb-title">Bumblebee</div>
      <div class="lb-sub">–¢—É—Ä–Ω–∏—Ä–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞</div>
    </div>

    <div class="lb-seg" role="tablist" aria-label="Leaderboard period">
      <button type="button" data-lb-tab="today" aria-pressed="true">–î–µ–Ω—å</button>
      <button type="button" data-lb-tab="all">–í—Å–µ</button>
    </div>
  </div>

<!-- –¢—ã -->
<div class="lb-you" id="lb-you">
  <div class="lb-you__avatar"
       id="lb-you-ava"
       data-role="lb-you-avatar">YOU</div>

  <div class="lb-you__meta">
    <div class="lb-you__name"
         id="lb-you-name"
         data-role="lb-you-name">You</div>

    <div class="lb-sub"
         id="lb-you-note"
         data-role="lb-you-label">best score</div>
  </div>

  <div class="lb-you__score"
       id="lb-you-score"
       data-role="lb-you-score">0</div>
</div>



  <!-- –¢–æ–ø -->
  <div class="lb-list" id="lb-list">
    <!-- —Å—é–¥–∞ JS —Ä–µ–Ω–¥–µ—Ä–∏—Ç —Å—Ç—Ä–æ–∫–∏ -->
  </div>

<div class="lb-actions">
  <button class="lb-btn"
          id="lb-refresh"
          type="button"
          data-lb-refresh>
    <span data-role="lb-refresh-label">–û–±–Ω–æ–≤–∏—Ç—å</span>
  </button>

  <button class="lb-btn lb-btn--primary"
          type="button"
          data-open-flappy>
    –ò–≥—Ä–∞—Ç—å
  </button>
</div>


</section>



<!-- BONUSES -->
  <section class="page" id="bonuses">
    <div class="card page-title">
      <h2 class="h1">–ë–æ–Ω—É—Å—ã</h2>
      <p class="muted-sm">–ö—Ä—É—Ç–∏ –∫–æ–ª–µ—Å–æ –∏ –∑–∞–±–∏—Ä–∞–π –≤—ã–ø–∞–≤—à–∏–π –ø–æ–¥–∞—Ä–æ–∫. –í—Ä–∞—â–µ–Ω–∏–µ 100 –º–æ–Ω–µ—Ç</p>
    </div>

    <div class="card bonus-card">
      <div class="h2"></div>

      <!-- –í–ï–†–•: —Ç–æ–ª—å–∫–æ –ø–ª–∞—à–∫–∞-–ø–æ–¥—Å–∫–∞–∑–∫–∞ -->
      <div class="bonus-head">
        <div id="pickedPill" class="picked-pill muted">–ù–∞–∂–º–∏ ¬´–ö—Ä—É—Ç–∞–Ω—É—Ç—å¬ª</div>
      </div>

      <!-- –ö–û–õ–ï–°–û -->
<div id="bonusWheel" class="bonus-wheel" aria-live="polite">
  <div class="wheel-track" id="wheelTrack">
    <button class="bonus" data-code="mug" data-name="–ö—Ä—É–∂–∫–∞">
      <img src="img/beer_cup.png" alt="–ö—Ä—É–∂–∫–∞"><span>–ö—Ä—É–∂–∫–∞</span>
    </button>
    <button class="bonus" data-code="tshirt" data-name="–§—É—Ç–±–æ–ª–∫–∞">
      <img src="img/tshirt.png" alt="–§—É—Ç–±–æ–ª–∫–∞"><span>–§—É—Ç–±–æ–ª–∫–∞</span>
    </button>
    <button class="bonus" data-code="nuts" data-name="–§–∏—Å—Ç–∞—à–∫–∏">
      <img src="img/pistachio.png" alt="–§–∏—Å—Ç–∞—à–∫–∏"><span>–§–∏—Å—Ç–∞—à–∫–∏</span>
    </button>
    <button class="bonus" data-code="discount" data-name="–°–∫–∏–¥–∫–∞ -10%">
      <img src="img/bonus4.png" alt="–°–∫–∏–¥–∫–∞ -10%"><span>–°–∫–∏–¥–∫–∞</span>
    </button>
    <button class="bonus" data-code="tasting" data-name="–î–µ–≥—É—Å—Ç–∞—Ü–∏—è">
      <img src="img/tongue-out.png" alt="–î–µ–≥—É—Å—Ç–∞—Ü–∏—è"><span>–î–µ–≥—É—Å—Ç–∞—Ü–∏—è</span>
    </button>
    <button class="bonus" data-code="coins_20" data-name="20 –º–æ–Ω–µ—Ç">
      <img src="img/coin.png" alt="20 –º–æ–Ω–µ—Ç"><span>20 –º–æ–Ω–µ—Ç</span>
    </button>
    <button class="bonus" data-code="coins_5" data-name="5 –º–æ–Ω–µ—Ç">
      <img src="img/coin.png" alt="5 –º–æ–Ω–µ—Ç"><span>5 –º–æ–Ω–µ—Ç</span>
    </button>
  </div>
  <div class="wheel-center"></div>
</div>


      <!-- –ù–ò–ó: –¥–≤–µ –∫–Ω–æ–ø–∫–∏ –≤ —Ä—è–¥ -->
      <div class="actions">
        <button class="btn btn-primary" id="spinBtn">–ö—Ä—É—Ç–∞–Ω—É—Ç—å</button>
        <button class="btn btn-primary" id="claimBtn" disabled>–ó–∞–±—Ä–∞—Ç—å</button>
      </div>
    </div>
      </section>

      <!-- ========== PROFILE PAGE (–±–µ–∑ —à–∞–±–ª–æ–Ω–æ–≤) ========== -->
<section id="profile" class="card profile">
  <!-- ===== PROFILE ¬∑ HERO ===== -->
<!-- ===== PROFILE ¬∑ HERO ===== -->
<section class="card profile-hero">
  <div class="pf-hero">
    <div class="pf-about">
      <div class="pf-title" id="pf-title">–ì–æ—Å—Ç—å</div>
      <div class="pf-hint" id="pf-username"></div>
    </div>

<div class="metric metric--balance">
  <div class="metric__val">
    <span id="pf-coins">0</span>
    <i class="coin-ico" aria-hidden="true"></i>
  </div>
  <div class="metric__lbl"></div>
</div>

    <!-- –∞–≤–∞—Ç–∞—Ä —Å–ø—Ä–∞–≤–∞ -->
    <img class="pf-ava" id="pf-ava" alt="">
  </div>
</section>
<div aria-hidden="true" style="height:30px;"></div>

<!-- ===== BLOCK 2: –ü—Ä–∏–∑—ã ¬∑ –ò–≥—Ä—ã ===== -->
<section class="card profile-block">
  <div class="section-title">üéØ –ú–æ–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è</div>


  <div class="metrics">
    <div class="metric">
      <div class="metric__val" id="pf-flappy-best">0</div>
      <div class="metric__lbl">–®–º–µ–ª—å ‚Äî –ª—É—á—à–∏–π —Å—á—ë—Ç</div>
    </div>
    <div class="metric">
      <div class="metric__val" id="pf-pass-count">0/6</div>
      <div class="metric__lbl">–ü–∞—Å–ø–æ—Ä—Ç ‚Äî —à—Ç–∞–º–ø—ã</div>
    </div>
    <div class="metric">
      <div class="metric__val" id="pf-pass-list">‚Äî</div>
      <div class="metric__lbl">–ü–æ–ª—É—á–µ–Ω—ã</div>
    </div>
        <div class="metric">
      <div class="metric__val" id="pf-refs-count">0</div>
      <div class="metric__lbl">–ú–æ–∏ —Ä–µ—Ñ–µ—Ä–∞–ª—ã</div>
    </div>
  </div>
</section>

<div aria-hidden="true" style="height:25px;"></div>


<!-- ===== BLOCK 3: –¢—É—Ä–Ω–∏—Ä ¬∑ –†–µ—Ñ–µ—Ä–∞–ª—ã ===== -->
<section class="card profile-block">
  <div class="section-title">üèÜ –¢—É—Ä–Ω–∏—Ä</div>

  <div class="metrics">
    <div class="metric">
      <div class="metric__val" id="pf-today-rank">‚Äî</div>
      <div class="metric__lbl">–ú–µ—Å—Ç–æ —Å–µ–≥–æ–¥–Ω—è</div>
    </div>
    <div class="metric">
      <div class="metric__val" id="pf-all-rank">‚Äî</div>
      <div class="metric__lbl">All-time</div>
    </div>

  </div>

  <!-- =====<div class="actions">
    <button class="btn btn-white" id="pf-join">–£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å</button>
    <button class="btn btn-white" id="pf-invite">–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å</button>
  </div>===== -->
  <div aria-hidden="true" style="height:19px;"></div>

<div class="panel panel--prizes">
  <div class="panel__head">
 
    <div class="panel__title">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø—Ä–∏–∑—ã</div>
  </div>
  <div class="ticker js-ticker">
    <div class="chips ticker__track" id="pf-prizes">
      <span class="chip chip--muted">–ü–æ–∫–∞ –ø—É—Å—Ç–æ</span>
    </div>
    <div class="chips ticker__track ticker__clone" aria-hidden="true"></div>
  </div>
</div>




</section>



    </main>
  </div>

  <script src="js/app_block_04.js"></script>

  <script src="js/app_block_05.js"></script>


<script src="js/app_block_06.js"></script>











<script src="js/app_block_07.js"></script>


  
<script src="js/app_block_08.js"></script>

<!-- –õ–æ–≥–∏–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è -->
<script src="js/app_block_09.js"></script>

<script src="js/app_block_10.js"></script>

<script src="js/app_block_11.js"></script>






<!-- === LATE PATCH: server-backed coins/bonuses/game logging (fresh_state aware) === -->
<script src="js/app_block_12.js"></script>

  <script src="js/app_block_13.js"></script>







<!-- === CLEAN FRONT CORE (server-driven) === -->
<script src="js/app_block_14.js"></script>

<script src="js/app_block_15.js"></script>


<!-- ===== Hotfix: PIN confirm + reliable badges + LB today/all ===== -->
<script src="js/app_block_16.js"></script>
<script src="js/app_block_17.js"></script>


<script src="js/app_block_18.js"></script>


<script src="js/app_block_19.js"></script>


<script src="js/app_block_20.js"></script>


<script src="js/app_block_21.js"></script>


<script src="js/app_block_22.js"></script>


<!-- === injected fast ping + overrides === -->

<script src="js/app_block_23.js"></script>
    

<script defer src="js/openSheet.final.v2.js?v=2"></script>


<script>
(() => {
  // –∞–¥—Ä–µ—Å –≤–æ—Ä–∫–µ—Ä–∞
  const API_BASE = 'https://craftbeer-demo.cyberian13.workers.dev';

  // --- –ü—Ä–µ–ª–æ–∞–¥–µ—Ä (–∫–∞–∫ —Ä–∞–Ω—å—à–µ) ---
  const $pre = () => document.getElementById('app-preloader');
  const $cap = () => document.getElementById('app-preloader-caption');

  let LOADER_T0 = 0;
  let LOADER_FILL_DONE = false;

  function setCaption(t){ const c=$cap(); if(c) c.textContent=String(t||''); }
  function showLoader(t){
    const el=$pre(); if(!el) return;
    if(t) setCaption(t);
    LOADER_T0 = performance.now();
    LOADER_FILL_DONE = false;
    const beer = el.querySelector('.beer');
    beer?.addEventListener('animationend', (e)=>{ if(e.animationName==='fill') LOADER_FILL_DONE=true; }, {once:true});
    el.classList.remove('is-hidden');
  }
  function hideLoader(force=false){
    const el=$pre(); if(!el) return;
    el.classList.add('is-hidden');
    if (force) setTimeout(()=>{ try{ el.remove(); }catch(_){ } }, 380);
  }
  window.addEventListener('error', ()=>hideLoader(false));
  window.addEventListener('unhandledrejection', ()=>hideLoader(false));

  // —Å–ø–∏–Ω–Ω–µ—Ä-—Å—Ç—Ä–∞—Ö–æ–≤–∫–∞ –¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞
  function ensureSpinnerRuns(){
    const c = document.querySelector('.spinner-dash');
    if (!c) return;
    const r = Number(c.getAttribute('r') || 108);
    const len = Math.round(2 * Math.PI * r);
    c.style.strokeDasharray = `120 ${len}`;
    const before = getComputedStyle(c).strokeDashoffset;
    setTimeout(() => {
      const after = getComputedStyle(c).strokeDashoffset;
      if (before === after || !after){
        let t0 = null; const period = 1.15;
        function loop(ts){
          if (!t0) t0 = ts;
          const dt = (ts - t0) / 1000;
          c.style.strokeDashoffset = String(-(len * (dt % period) / period));
          requestAnimationFrame(loop);
        }
        requestAnimationFrame(loop);
      }
    }, 400);
  }

  // –∂–¥—ë–º –º–∏–Ω–∏–º—É–º –æ–¥–∏–Ω —Ü–∏–∫–ª ¬´–Ω–∞–ª–∏–≤–∞–Ω–∏—è¬ª
  async function waitLoaderCycle(minVisibleMs=1400, fillMs=1800){
    const elapsed = performance.now()-LOADER_T0;
    const leftVisible = Math.max(0, minVisibleMs - elapsed);
    const leftFill    = LOADER_FILL_DONE ? 0 : Math.max(0, fillMs - elapsed);
    const wait = Math.max(leftVisible, leftFill);
    if (wait>0) await new Promise(r=>setTimeout(r, wait));
  }

  // --- fetch helper: –ë–ï–ó –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ (—á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ preflight-–ø—Ä–æ–≤–∞–ª–∞) ---
  const sleep = (ms)=>new Promise(r=>setTimeout(r,ms));
  async function jpostJSON(url, body, timeoutMs=12000){
    const ctrl = new AbortController(); const t = setTimeout(()=>ctrl.abort('timeout'), timeoutMs);
    try{
      const r = await fetch(url, {
        method:'POST',
        cache: 'no-store',              // –±—Ä–∞—É–∑–µ—Ä –Ω–µ –±—É–¥–µ—Ç –±—Ä–∞—Ç—å –∏–∑ —Å–≤–æ–µ–≥–æ –∫—ç—à–∞
        headers:{
          'Content-Type':'application/json',
          'Accept':'application/json'
        },
        body: JSON.stringify(body||{}),
        signal: ctrl.signal
      });
      const ct = r.headers.get('content-type')||''; const raw = await r.text();
      let data; try{ data = JSON.parse(raw); }
      catch(e){ console.error('NOT JSON', {url, status:r.status, ct, raw: raw.slice(0,400)}); throw new Error(`Bad JSON from ${url} (HTTP ${r.status})`); }
      if (!r.ok) throw new Error(data?.error || `HTTP ${r.status}`);
      return data;
    } finally { clearTimeout(t); }
  }

  // --- –ø—Ä–æ—Å—Ç—ã–µ DOM-–∞–ø–¥–µ–π—Ç–µ—Ä—ã –Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ —Ç–≤–æ–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π –Ω–µ—Ç ---
  const setText = (sel, v)=>{ const el=document.querySelector(sel); if(el) el.textContent=String(v??''); };
  const setHTML = (sel, html)=>{ const el=document.querySelector(sel); if(el) el.innerHTML=html; };

  // --- –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ state –∫ UI (–ø—Ä–æ—Ñ–∏–ª—å, –ø—Ä–∏–∑—ã, —à—Ç–∞–º–ø—ã, —Ç—É—Ä–Ω–∏—Ä) ---
  function applyState(s){
    if (!s) return;

    // –ø—Ä–æ—Ñ–∏–ª—å
    if (typeof updateCoinsUI==='function') updateCoinsUI(s.coins); else if (s.coins!=null) setText('[data-coins]', s.coins);
    if (typeof updateStylesCounter==='function') updateStylesCounter(s.styles_count, s.styles_total);
    else if (s.styles_count!=null) setText('[data-styles]', `${s.styles_count??0}/${s.styles_total??''}`);
    if (typeof updateRefTotal==='function') updateRefTotal(s.ref_total); else if (s.ref_total!=null) setText('[data-ref-total]', s.ref_total);
    if (typeof updateLastStamp==='function') updateLastStamp(s.last_stamp_name); else if (s.last_stamp_name) setText('[data-last-stamp]', s.last_stamp_name);

    // –ø–æ—Å–ª–µ–¥–Ω–∏–µ –ø—Ä–∏–∑—ã
    if (Array.isArray(s.last_prizes)){
      if (typeof updateLastPrizes==='function') updateLastPrizes(s.last_prizes);
      else setHTML('[data-last-prizes]', s.last_prizes.map(p=>`
        <li class="prize-row">
          <span class="prize-name">${p.name ?? p.prize ?? '–ü—Ä–∏–∑'}</span>
          <span class="prize-when">${p.when ?? ''}</span>
        </li>`).join(''));
    }

    // –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö —à—Ç–∞–º–ø–æ–≤
    if (Array.isArray(s.styles_collected)){
      const ids = new Set(s.styles_collected.map(x=>String(x)));
      document.querySelectorAll('[data-style-id]').forEach(el=>{
        const id = String(el.getAttribute('data-style-id')||'');
        el.classList.toggle('is-collected', ids.has(id));
      });
    }

    // —Ç—É—Ä–Ω–∏—Ä
    if (Array.isArray(s.leaderboard_today)){
      if (typeof renderLeaderboardToday==='function') renderLeaderboardToday(s.leaderboard_today);
      else setHTML('[data-leaderboard-today]', s.leaderboard_today.map((r,i)=>`<div class="lb-row"><b>${i+1}.</b> ${r.name??r.username??'–ò–≥—Ä–æ–∫'} ‚Äî ${r.score??0}</div>`).join(''));
    }
    if (Array.isArray(s.leaderboard_alltime)){
      if (typeof renderLeaderboardAlltime==='function') renderLeaderboardAlltime(s.leaderboard_alltime);
      else setHTML('[data-leaderboard-alltime]', s.leaderboard_alltime.map((r,i)=>`<div class="lb-row"><b>${i+1}.</b> ${r.name??r.username??'–ò–≥—Ä–æ–∫'} ‚Äî ${r.score??0}</div>`).join(''));
    }

    if (s.game_today_best!=null && typeof updateTodayBest==='function') updateTodayBest(s.game_today_best);
    if (s.game_plays_today!=null && typeof updateTodayPlays==='function') updateTodayPlays(s.game_plays_today);

    if (s.config && typeof cacheConfig==='function') cacheConfig(s.config);
  }

  // --- watcher –ø–æ kv_sig ---
  let LAST_SIG = null, WATCH_ABORT = false;
  async function watchState(tg_init, uid){
    WATCH_ABORT = false;
    while (!WATCH_ABORT){
      try{
        // —Ç–æ–ª—å–∫–æ body (uid, bust), –ù–ò–ö–ê–ö–ò–• –∫–∞—Å—Ç–æ–º-–∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
        const st = await jpostJSON(`${API_BASE}/api/mini/state?bust=${Date.now()}`, { tg_init, fresh:false, uid, bust:Date.now() });
        if (st?.kv_sig && st.kv_sig !== LAST_SIG){
          LAST_SIG = st.kv_sig;
          if (!st.uid || String(st.uid) === String(uid)) applyState(st);
        }
      }catch(_){}
      await sleep(15000);
    }
  }

  // --- /api/mini/event: —Å—Ä–∞–∑—É –ø—Ä–∏–º–µ–Ω—è–µ–º fresh_state ---
  window.postMiniEvent = async function(type, data, tg_init, uid){
    const res = await jpostJSON(`${API_BASE}/api/mini/event?bust=${Date.now()}`, { tg_init, type, data, uid, bust:Date.now() });
    if (res?.fresh_state) applyState(res.fresh_state);
    return res;
  };

  // --- –æ–∂–∏–¥–∞–Ω–∏–µ –≤–∞–ª–∏–¥–Ω–æ–≥–æ state (—Ä–µ—Ç—Ä–∞–∏) ---
  async function waitForState(tg_init, uid, switched){
    let attempt = 0;
    while (true){
      attempt++;
      try{
        setCaption(`–ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è‚Ä¶ –ø–æ–ø—ã—Ç–∫–∞ ${attempt}`);
        const common = { tg_init, uid, bust: Date.now() };
        const boot = await jpostJSON(`${API_BASE}/api/mini/bootstrap?bust=${Date.now()}`, { ...common, fresh:true, force: !!switched });
        const st   = await jpostJSON(`${API_BASE}/api/mini/state?bust=${Date.now()}`,     { ...common, fresh:false });

        const state = (st?.ok ? st : (boot?.fresh_state ? { ok:true, ...boot.fresh_state } : null));
        if (state && (state.ok || state.coins!=null || state.config)){
          if (!state.uid || String(state.uid) === String(uid)) return state;
        }
        throw new Error('state_invalid');
      }catch(e){
        const delay = Math.min(6000, 1000*attempt);
        setCaption(`–ù–µ—Ç —Å–≤—è–∑–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–º, –ø—ã—Ç–∞–µ–º—Å—è —Å–Ω–æ–≤–∞‚Ä¶ (${Math.round(delay/1000)}s)`);
        await sleep(delay);
      }
    }
  }

  // --- –≥–ª–∞–≤–Ω—ã–π init —Å –¥–µ—Ç–µ–∫—Ç–æ–º —Å–º–µ–Ω—ã –∞–∫–∫–∞—É–Ω—Ç–∞ ---
  async function initAppUltra(){
    const tg = window.Telegram?.WebApp;
    const tg_init = tg?.initData || '';
    const UID = String(tg?.initDataUnsafe?.user?.id || '');
    const lastUid = sessionStorage.getItem('last_uid') || '';
    const switched = UID && lastUid && UID !== lastUid;

    if (switched){ LAST_SIG = null; window.APP_STATE = null; WATCH_ABORT = true; }
    if (UID) sessionStorage.setItem('last_uid', UID);

    showLoader('–ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è‚Ä¶');
    ensureSpinnerRuns(); // –≥–∞—Ä–∞–Ω—Ç –∫—Ä—É—á–µ–Ω–∏—è –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ
    tg?.showProgress?.();

    try{
      const state = await waitForState(tg_init, UID, switched);
      window.APP_STATE = state;

      applyState(window.APP_STATE);
      if (typeof renderAll === 'function') renderAll(window.APP_STATE);

      await waitLoaderCycle();   // –º–∏–Ω–∏–º—É–º –æ–¥–∏–Ω —Ü–∏–∫–ª –∞–Ω–∏–º–∞—Ü–∏–∏
      hideLoader(true);

      watchState(tg_init, UID);  // —Ñ–æ–Ω–æ–≤–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è KV
    }catch(e){
      console.error('initAppUltra fatal:', e);
      setCaption('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è. –ü–æ—Ç—è–Ω–∏—Ç–µ –≤–Ω–∏–∑, —á—Ç–æ–±—ã –æ–±–Ω–æ–≤–∏—Ç—å.');
    }finally{
      tg?.ready?.();
      tg?.hideProgress?.();
    }
  }

  document.addEventListener('DOMContentLoaded', initAppUltra);
})();
</script>
















    
<script>
        // ====== –õ–Å–ì–ö–ê–Ø DEV-–ü–ê–ù–ï–õ–¨ –°–í–ï–†–•–£ ======
(function () {
  if (window.__TG_DEBUG_PANEL__) return; // —á—Ç–æ–±—ã –Ω–µ —Å–æ–∑–¥–∞–ª–∞—Å—å –¥–≤–∞–∂–¥—ã
  window.__TG_DEBUG_PANEL__ = true;

  let panel, inner;

  function ensurePanel() {
    if (panel) return panel;

    panel = document.createElement('div');
    panel.id = 'debug-panel';
    panel.style.position = 'fixed';
    panel.style.left = '0';
    panel.style.top = '0';          // üî• –ø–∞–Ω–µ–ª—å —Å–≤–µ—Ä—Ö—É
    panel.style.bottom = '';        // –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–∏–∂–∏–º–∞–µ–º –∫ –Ω–∏–∑—É
    panel.style.width = '100%';
    panel.style.maxHeight = '40%';
    panel.style.overflowY = 'auto';
    panel.style.fontSize = '11px';
    panel.style.fontFamily = 'monospace';
    panel.style.background = 'rgba(0,0,0,.85)';
    panel.style.color = '#0f0';
    panel.style.zIndex = '999999';
    panel.style.padding = '4px 6px';
    panel.style.boxSizing = 'border-box';
    panel.style.whiteSpace = 'pre-wrap';
    panel.style.wordBreak = 'break-word';

    inner = document.createElement('div');
    inner.textContent = '[debug] –ø–∞–Ω–µ–ª—å –ª–æ–≥–æ–≤ (—Ç–∞–ø–Ω–∏, —á—Ç–æ–±—ã —Å–∫—Ä—ã—Ç—å)';
    panel.appendChild(inner);

    panel.addEventListener('click', () => {
      // –ø–æ —Ç–∞–ø—É –ø—Ä–æ—Å—Ç–æ —Å–∫—Ä—ã–≤–∞–µ–º/–ø–æ–∫–∞–∑—ã–≤–∞–µ–º
      if (panel.style.opacity === '0') {
        panel.style.opacity = '1';
        panel.style.pointerEvents = 'auto';
      } else {
        panel.style.opacity = '0';
        panel.style.pointerEvents = 'none';
      }
    });

    document.body.appendChild(panel);
    return panel;
  }

  function writeLine(text, type) {
    ensurePanel();
    const line = document.createElement('div');
    const ts = new Date().toISOString().substr(11, 8); // HH:MM:SS
    line.textContent = `[${ts}] ${text}`;

    if (type === 'err') line.style.color = '#f55';
    if (type === 'warn') line.style.color = '#ff0';

    inner.appendChild(line);
    panel.scrollTop = panel.scrollHeight;
  }

  // –ø—É–±–ª–∏—á–Ω—ã–µ —Ö–µ–ª–ø–µ—Ä—ã
  window.dbg = function (...args) {
    writeLine(args.map(a => {
      if (typeof a === 'string') return a;
      try { return JSON.stringify(a); } catch (e) { return String(a); }
    }).join(' '), 'log');
  };

  window.dbgTag = function (tag, ...args) {
    window.dbg(`[${tag}]`, ...args);
  };

  // –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π console.*
  const origLog = console.log;
  const origWarn = console.warn;
  const origErr = console.error;

  console.log = function (...args) {
    origLog.apply(console, args);
    writeLine(args.join(' '), 'log');
  };
  console.warn = function (...args) {
    origWarn.apply(console, args);
    writeLine(args.join(' '), 'warn');
  };
  console.error = function (...args) {
    origErr.apply(console, args);
    writeLine(args.join(' '), 'err');
  };

  // —Å—Ç–∞—Ä—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
  writeLine('Debug panel ready (tap to hide/show)', 'log');
})();
</script> 


    

</body>
</html>

<!-- ===== Instant loader patch (KV-first + fresh) ===== -->
